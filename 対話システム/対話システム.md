[TOC]

# 対話システム



## 前提



### 対話システムの効果

- ハンズフリーでの機器操作
- 目を離しても機器操作可能
- 直感的に
- 人間を精神的に支える
  - メディアの等式：たとえ相手がコンピュータであっても、やり取りを行うものであればあたかもそれが人間であるかのように扱ってしまう性質
  - 話を聞いてもらったり励ましてもらうだけで元気が出る



### 対話システムの難しさ

- 含意。直接言われていないが、発言そのものを超えた意図がおうおうにして言葉に含まれ、それを理解する必要がある。
  - 今日は暑いね→クーラーを付けてください。
- シンボルグラウンディング問題
  - その、や　あの を適切に理解する必要あり
- フレーム問題
  - 考える範囲を適切に設定する



### 対話システムの基礎知識

- 第一次ブーム；1950後半〜1960年代
  - ELIZA（イライザ）：相手の発話を復唱 or もう少し詳しく教えて下さい
- 第二次ブーム；1980年代
  - エキスパートシステム→知識獲得のボトルネック



### 対話システムの種類

- タスクの有無
  - タスク指向型対話システム
    - 天気情報案内システム
    - レストラン検索システム
  - 非タスク指向型対話システム＝雑談対話システム
- 人数
  - 基本は 1 対 1 
  - マルチパーティ対話システム
- モダリティ
  - マルチモーダル対話システム→Peppar : 音声 + タッチパネル, 身振り手振り



## タスク指向型対話システム



### 状態遷移

#### ユーザから聞き出す情報

- 地名：都道府県のいずれか
- 日付：今日　明日
- 情報種別：天気　気温



#### 状態

- 状態1 : ユーザから地名を聞き出す状態（開始状態）
- 状態2 : ユーザーから日付を聞き出す状態
- 状態3 : ユーザーから情報種別を聞き出す状態
- 状態4 : ユーザーに天気情報を伝える状態（終了状態）

有限状態オートマトン→ SCXML（State Chart XML）で記述→states.scxml



#### SCXML を用いたプログラム

- STEP1 : states.scxml を読み込んで開始状態に遷移する
- STEP2 : システムは現在の状態に紐付いた発話を行う
- STEP3 : ユーザー発話を受け付けてイベント（place, date, type）に変換し、状態を遷移させる
- STEP4 : tell_info の状態に到達していれば、これまでに得られた上から外部APIで情報取得しユーザーに伝える。そうでない場合は STEP2 にモデル



### フレームに基づくタスク指向型対話システム

- フレーム：複数のスロット（属性と値のペア）からなる構造
- フレームの中では、要素の順番は問わないため、ユーザは自由に発話可能になる。



#### フレームを用いたプログラム

- STEP1 : フレームを初期化する
- STEP2 : システムが（オープンな）初期発話を行う
- STEP3 : ユーザー発話を受取、対話行為タイプとコンセプトを抽出する
- STEP4 : フレームを更新する
- STEP5 : フレームに基づきシステムの次の対話行為を決定する
- STEP6 ; システムの次の対話行為が tell-info であれば天気情報を伝える。それ以外の場合はステップ3に戻る



## 非タスク指向型対話システム



### ルールベース方式

**フォーマット**

- AIML

  - 多くが AIML（Artificial Intelligence Markup Language）というマークアップ言語を用いてルールが書かれている

  - AIML でルールを買いて、python , ruby, java 等様々な言語でパース

  - 代表的な A.L.I.C.E. のクローンや有志が作ったAIMLをダウンロードして簡単に高性能なルールを使った対話システムを作成可能

  ```
  <?xml version="1.0" encoding="utf-8"?>
  <aiml version="1.0.1" encoding="UTF-8">
  	<category>
  		<pattern>ユーザ発話</pattern>
  		<template>システム応答</template>
  	</category>
  </aiml>
  ```

  - pattern の要素と、ユーザ発話が完全一致していれば、template の内容を返す

    → _ * などの正規表現の使用が必須

  ```
  <category>
  	<pattern>_ 大阪 _</pattern>
  	<template>大阪といえばたこ焼きですね</template>
  </category>
  ```

  - star 記法：マッチした文字列を応答で再利用

  ```
  <category>
  	<pattern>* へ 旅行 に 行き まし た</pattern>
  	<template><star/>に旅行ですか、いいですね</template>
  </category>
  ```

  - get / set 記法：star では1回の応答でしか再利用できない。

  ```
  <category>
  	<pattern>私 の 名前 は * です</pattern>
  	<template><set name="username"><star/></set>さんですか。よろしくおねがいします。</template>
  </category>
  
  <category>
  	<pattern>さようなら</pattern>
  	<template><get name="username"/>さん、さようなら。</template>
  </category>
  ```

  - think 記法：set の段階で表示しない

  ```
  <category>
  	<pattern>私 の 名前 は * です</pattern>
  	<template>
  		<think><set name="username"><star/></set></think>
  		こんにちは、よろしくおねがいします。
  	</template>
  </category>
  
  <category>
  	<pattern>さようなら</pattern>
  	<template><get name="username"/>さん、さようなら。</template>
  </category>
  ```

  - 他、that, topic, random, srai などの記法がある。



- VoiceXML
  - 音声での対話を行うためのルール形式
- xAIML
  - AIML + 再帰処理、文脈の制約
  - NTTドコモの対話システムでも使用されている



**参考**

- ブラウザ上で、AIMLファイルアップロードするとチャットできる　
  - https://home.pandorabots.com/dash/graph → AIML 2.0



### 用例ベース（検索ベース）方式

- チャットや掲示板（あるいは映画や演劇の台本）から、人間同士の応答のデータを集めて、それを参考に発話を決める
- Jabberwacky や George が有名
- 全文検索エンジン：Elasticsearch
  - ユーザ発話と、用例のクエリについて、単語の重複率や重複した単語の珍しさなどから類似度を計算している
  - デフォルトの全文検索のスコアを改良できる
  - コサイン類似度、レーベンシュタイン距離を使用するでも良い
    - コサイン類似度：単語の重複を考慮するイメーず
    - レーベンシュタイン距離：文字の並びを考慮するイメージ。2つの文が違うほど値あ大きくなる点に注意。
  - 特定のキーワードがでてきたら bonus を追加するように評価関数を作成すると、ボットに個性を出せる。（スターウォーズ好きBotとか）

```
./bin/elasticsearch -d -p pid # Elasticsearchをデーモン起動

pkill -F pid # 終わったらこれを忘れずに。
```



**流れ**

- Elasticsearch に接続する
- ユーザ発話を使って Elasticsearch から応答候補を検索する
- 対応する応答を取り出す



**機械学習の活用**

- ユーザー発話の分散表現獲得
- 応答選択のための評価関数に使用



### 生成ベース方式

- 機械翻訳の技術を対話に応用
- 大量の発話と応答のペアが必要



## memo



### タスク指向型

対話システムは複数の機械学習要素を組み合わせて作成されている

システムからの詰問にならずに、ある程度自由な発話を通してタスクをこなせるようにするには、フレームを利用する。

（天気を教えてくれるボットの場合に、①どこの天気を？②いつ？③気温の情報もいる？のように1つ1つの情報を順番に取得していくと、詰問されているような印象になる。）

フレームは、「天気情報」みたいな大枠の中に、要素として「place」「date」「type」のように情報をもたせる形。こうすると、「明日の東京都の天気と気温を教えて」なんていう風に問いかけられた時に天気情報フレームの中で「place＝東京都」「date＝明日」「type＝天気、気温」といった風に値が格納される。要素が不十分な場合には、足りていない要素のみをシステム側が問うようにすればよい。



機械学習の活用では、下記2点。

① 対話行為タイプの分類：発問が、「天気情報」のフレームに合致する発話かどうか、を分類

- 普通に分類モデルを作成すればOK

②固有表現抽出：「天気情報」のフレームに合致する発話出会った場合に、文章からフレームの要素を抽出するために使用。例えば「明日」には「date」というラベルをつけ、「天気」には「type」というラベルをつける。など。

- 単語列にラベル付けする場合、IOB（Inside-Outside-Beginning）形式のラベルを用いるのが一般的。

  - B- : ラベルはじまり
  - I- : ラベルおわりまたは途中
  - o : ラベル付与の非対象

  ```
  東京都練馬区の明日の気温は？
  
  東京都(B-place)/練馬区（I-place）/の（o）/明日（B-date）/の（o）/気温（B-type）/は（o）/？（o）
  ```

  







